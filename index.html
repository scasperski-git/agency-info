<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agency Information Submission</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg, #eef1f4, #f4f6f8);
  padding: 20px;
}
.container {
  max-width: 420px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}
h2 { text-align:center; margin-bottom:5px; }
.subnote {
  text-align:center;
  font-size:12px;
  color:#666;
  margin-bottom:10px;
}
label { font-weight:bold; }
input[type="text"], input[type="tel"] {
  width:100%; padding:10px; margin:5px 0 10px;
  border:1px solid #ccc; border-radius:5px;
  text-transform:uppercase;
}
::placeholder { text-transform:none; color:#999; }

.consent { font-size:13px; color:#555; margin-top:10px; }

button {
  width:100%; padding:12px;
  background:#1e88e5; color:#fff;
  border:none; border-radius:5px;
  font-size:16px;
  opacity:.6; cursor:not-allowed;
}
button.enabled { opacity:1; cursor:pointer; }

.helper { font-size:12px; color:#777; text-align:center; margin-top:5px; }

</style>
</head>

<body>

<div class="container" id="formBox">
  <h2 id="formTitle">üìÑ AGENCY INFORMATION SUBMISSION</h2>
  <div class="subnote" id="formNote"></div>

  <form onsubmit="return submitForm();">

    <label>Agency Name (Mandatory)</label>
    <input type="text" id="agency" placeholder="Example: ABC DEBT SDN BHD" onblur="checkDuplicate()">

    <label>PIC Name 1 (Mandatory)</label>
    <input type="text" id="pic1" placeholder="Example: MR JOHN DOE">

    <label>PIC Name 2 (Optional)</label>
    <input type="text" id="pic2" placeholder="Example: MISS JANE DOE">

    <label>Contact No (Mandatory)</label>
    <input type="tel" id="contact1" placeholder="Example: 0123456789" oninput="formatPhone(this)">

    <label>Contact No (Optional)</label>
    <input type="tel" id="contact2" placeholder="Example: 0123456789" oninput="formatPhone(this)">

    <label>WhatsApp No (Mandatory)</label>
    <input type="tel" id="whatsapp" placeholder="Example: 0123456789" oninput="formatPhone(this)">

    <div class="consent">
      <input type="checkbox" id="consent" onclick="updateState()">
      I confirm that the information provided is accurate and consent to its use
      for official communication purposes.
    </div>

    <button type="submit" id="submitBtn">Submit</button>
    <div class="helper" id="helperText"></div>
  </form>
</div>

<script>
let UPDATE_MODE = false;
let UPDATE_USED = false;

/* PHONE */
function formatPhone(el){
  let v = el.value.replace(/\D/g,'');
  if (v.startsWith("0")) v = "6"+v;
  if (!v.startsWith("6")) v = "6"+v;
  el.value = v;
}

/* DUPLICATE DETECT (FIRST WORD) */
function checkDuplicate(){
  if (UPDATE_USED) return;

  const name = agency.value.trim();
  if (!name) return;

  const key = name.split(" ")[0].toUpperCase();
  const lastKey = localStorage.getItem("LAST_AGENCY_KEY");

  if (lastKey && lastKey === key) {
    const ok = confirm(
      "Possible duplicate detected.\n\n" +
      "A previous submission with a similar agency name was detected.\n\n" +
      "Do you want to UPDATE the previous information?"
    );

    if (ok) enableUpdateMode();
  }

  localStorage.setItem("LAST_AGENCY_KEY", key);
}

/* UPDATE MODE */
function enableUpdateMode(){
  UPDATE_MODE = true;
  formTitle.innerText = "‚úèÔ∏è AGENCY INFORMATION UPDATE";
  formNote.innerText =
    "You are updating previously submitted information. This action is allowed once only.";
}

/* STATE */
function updateState(){
  const ok =
    agency.value && pic1.value && contact1.value && whatsapp.value;

  submitBtn.disabled = !ok || !consent.checked;
  submitBtn.classList.toggle("enabled", ok && consent.checked);

  helperText.innerText = !ok
    ? "Please complete all mandatory fields."
    : !consent.checked
      ? "Please confirm consent to proceed."
      : "";
}

/* SUBMIT */
function submitForm(){
  updateState();
  if (submitBtn.disabled) return false;

  if (UPDATE_MODE) UPDATE_USED = true;

  alert(
    UPDATE_MODE
      ? "Information updated successfully."
      : "Information submitted successfully."
  );

  return false;
}
</script>

</body>
</html>
