<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agency Information Submission</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html, body {
  height: 100%;
  margin: 0;
}

body {
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg, #eef1f4, #f4f6f8);
  padding: 20px;
  color: #000;
}

/* ===== CONTAINER ===== */
.container {
  max-width: 420px;
  margin: auto;
  background: #ffffff;
  padding: 16px 20px 20px;
  border-radius: 8px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  position: relative;
}

/* SUCCESS BOX */
.success-container {
  max-width: 520px;
}

/* ===== TEXT ===== */
h2 {
  text-align: center;
  margin-top: 0;
  margin-bottom: 8px;
}

label {
  font-weight: bold;
}

input[type="text"],
input[type="tel"] {
  width: 100%;
  padding: 10px;
  margin: 5px 0 4px;
  border: 1px solid #ccc;
  border-radius: 5px;
  box-sizing: border-box;
  text-transform: uppercase; /* FORCE UPPERCASE WHILE TYPING */
}

::placeholder {
  text-transform: none;
  color: #999;
}

/* ===== ERROR ===== */
input.error {
  border-color: #e53935;
  background: #fff5f5;
}

.errorText {
  font-size: 12px;
  color: #e53935;
  margin-bottom: 8px;
  display: none;
}

/* ===== CONSENT ===== */
.consent {
  font-size: 13px;
  margin: 10px 0;
  color: #555;
}

/* ===== BUTTON ===== */
button {
  width: 100%;
  padding: 12px;
  background: #1e88e5;
  color: white;
  border: none;
  border-radius: 5px;
  font-size: 16px;
  opacity: 0.6;
  cursor: not-allowed;
}
button.enabled {
  opacity: 1;
  cursor: pointer;
}

/* ===== HELPER ===== */
.helper {
  font-size: 12px;
  color: #777;
  margin-top: 6px;
  text-align: center;
}

/* ===== SUCCESS ===== */
.successIcon {
  margin: 15px auto;
  width: 70px;
}
.successIcon svg {
  width: 100%;
}

.ref {
  font-weight: bold;
  text-align: center;
  margin: 6px 0 12px;
  font-size: 14px;
}

/* FORCE UPPERCASE FOR ALL USER DATA DISPLAY */
.summary {
  font-size: 14px;
  margin-top: 10px;
  line-height: 1.6;
  text-transform: uppercase;
}

/* WATERMARK */
.watermark {
  position: absolute;
  top: 45%;
  left: 50%;
  transform: translate(-50%, -50%) rotate(-25deg);
  font-size: 48px;
  color: rgba(0,0,0,0.06);
  font-weight: bold;
  display: none;
  pointer-events: none;
}

/* ===== FOOTER ===== */
.footer {
  margin-top: 25px;
  text-align: center;
  font-size: 11px;
  color: #888;
}
.divider {
  height: 2px;
  background: linear-gradient(to right, transparent, #1e88e5, transparent);
  margin-bottom: 10px;
}
.footer a {
  color: #888;
  text-decoration: none;
}
</style>
</head>

<body>

<!-- FORM -->
<div class="container" id="formBox">
  <h2>ðŸ“„ AGENCY INFORMATION SUBMISSION</h2>

  <form onsubmit="return submitForm();">

    <label>Agency Name (Mandatory)</label>
    <input type="text" id="agency" placeholder="Example: ABC DEBT SDN BHD">
    <div class="errorText" id="err_agency">This field is required</div>

    <label>PIC Name 1 (Mandatory)</label>
    <input type="text" id="pic1" placeholder="Example: MR JOHN DOE">
    <div class="errorText" id="err_pic1">This field is required</div>

    <label>PIC Name 2 (Optional)</label>
    <input type="text" id="pic2" placeholder="Example: MISS JANE DOE">

    <label>Contact No (Mandatory)</label>
    <input type="tel" id="contact1" placeholder="Example: 0123456789" oninput="formatPhone(this)">
    <div class="errorText" id="err_contact1">This field is required</div>

    <label>Contact No (Optional)</label>
    <input type="tel" id="contact2" placeholder="Example: 0123456789" oninput="formatPhone(this)">

    <label>WhatsApp No (Mandatory)</label>
    <input type="tel" id="whatsapp" placeholder="Example: 0123456789" oninput="formatPhone(this)">
    <div class="errorText" id="err_whatsapp">This field is required</div>

    <div class="consent">
      <input type="checkbox" id="consent" onclick="updateState()">
      I confirm that the information provided is accurate and consent to its use
      for official communication purposes.
    </div>

    <button type="submit" id="submitBtn">Submit</button>
    <div class="helper" id="helperText"></div>
  </form>
</div>

<!-- SUCCESS -->
<div class="container success-container" id="successBox" style="display:none;">
  <div class="watermark" id="watermark">SUBMITTED</div>

  <div class="successIcon">
    <svg viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="12" r="10" stroke="#1e88e5" stroke-width="2"/>
      <path d="M7 12l3 3 7-7" stroke="#1e88e5" stroke-width="2"/>
    </svg>
  </div>

  <h2>Submission Successful</h2>

  <div class="ref" id="refDisplay"></div>

  <div class="summary" id="summaryBox"></div>

  <div class="consent" style="margin-top:15px;">
    âœ” CONSENT CONFIRMED FOR OFFICIAL COMMUNICATION PURPOSES.
  </div>

  <p style="text-align:center;font-size:13px;">
    You may safely close this page.
  </p>
</div>

<!-- FOOTER -->
<div class="footer">
  <div class="divider"></div>
  <div id="trademark"></div>
  <div>
    Information submitted is collected solely for communication and
    administrative record purposes.
  </div>
</div>

<script>
const mandatoryFields = [
  { id: "agency", err: "err_agency" },
  { id: "pic1", err: "err_pic1" },
  { id: "contact1", err: "err_contact1" },
  { id: "whatsapp", err: "err_whatsapp" }
];

function formatPhone(el) {
  let v = el.value.replace(/\D/g,'');
  if (v.startsWith("0")) v = "6" + v;
  if (!v.startsWith("6")) v = "6" + v;
  el.value = v;
}

function generateRef() {
  const d = new Date();
  return "AGY-" +
    d.getFullYear() +
    String(d.getMonth()+1).padStart(2,"0") +
    String(d.getDate()).padStart(2,"0") + "-" +
    String(d.getHours()).padStart(2,"0") +
    String(d.getMinutes()).padStart(2,"0") +
    String(d.getSeconds()).padStart(2,"0");
}

function updateState() {
  let firstError = null;
  let ok = true;

  mandatoryFields.forEach(f => {
    const input = document.getElementById(f.id);
    const err = document.getElementById(f.err);

    if (!input.value.trim()) {
      ok = false;
      input.classList.add("error");
      err.style.display = "block";
      if (!firstError) firstError = input;
    } else {
      input.classList.remove("error");
      err.style.display = "none";
    }
  });

  if (!ok) {
    submitBtn.disabled = true;
    submitBtn.classList.remove("enabled");
    helperText.innerText = "Please complete all mandatory fields.";
    if (firstError) firstError.scrollIntoView({ behavior: "smooth", block: "center" });
    return;
  }

  if (!consent.checked) {
    submitBtn.disabled = true;
    submitBtn.classList.remove("enabled");
    helperText.innerText = "Please confirm consent to proceed.";
    return;
  }

  submitBtn.disabled = false;
  submitBtn.classList.add("enabled");
  helperText.innerText = "";
}

mandatoryFields.forEach(f => {
  document.getElementById(f.id).addEventListener("input", updateState);
});

function submitForm() {
  updateState();
  if (submitBtn.disabled) return false;

  const ref = generateRef();

    const data = new URLSearchParams();
  data.append("ref", ref);
data.append("agency", agency.value.toUpperCase());
data.append("pic1", pic1.value.toUpperCase());
data.append("pic2", pic2.value ? pic2.value.toUpperCase() : "");
data.append("contact1", contact1.value);
data.append("contact2", contact2.value);
data.append("whatsapp", whatsapp.value);
data.append("consent", "YES");


  fetch("https://script.google.com/macros/s/AKfycbzEVWi0kgI1qSKQeWWdCJzj8e8qoqNpCUDRZJoPd-e7fQHTedMTegESaVziYYfemLdG/exec", {
    method: "POST",
    body: data
  });


  formBox.style.display = "none";
  successBox.style.display = "block";
  watermark.style.display = "block";

  refDisplay.innerText = "REFERENCE NO: " + ref;

  summaryBox.innerHTML =
    `<div><b>AGENCY:</b> ${agency.value.toUpperCase()}</div>
     <div><b>PIC NAME 1:</b> ${pic1.value.toUpperCase()}</div>
     ${pic2.value ? `<div><b>PIC NAME 2:</b> ${pic2.value.toUpperCase()}</div>` : ""}
     <div><b>CONTACT (MANDATORY):</b> ${contact1.value}</div>
     ${contact2.value ? `<div><b>CONTACT (OPTIONAL):</b> ${contact2.value}</div>` : ""}
     <div><b>WHATSAPP NO:</b> ${whatsapp.value}</div>`;

  return false;
}

(function(){
  const year = new Date().getFullYear();
  trademark.innerHTML =
    `Â© ${year} <a href="https://sczpnet.org" target="_blank">sczpnet.org</a> Â· For Authorized Agency Use`;
})();
</script>

</body>
</html>
